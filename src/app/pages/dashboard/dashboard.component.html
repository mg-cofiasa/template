<div class="row">
  <div class="col-md-6">
    <div class="row jumbotron m-1 p-4 bg-white shadow">
      <div class="col-md-12">
        <p-button (click)="AgregarEditarMeta('agregar', 0)" icon="pi pi-plus" label="Crear meta" styleClass="rounded mb-2" size="small"></p-button>

        <p-table [value]="metasLista" selectionMode="single" [(selection)]="metaSeleccionada" (onRowSelect)="GetTareas()" [metaKeySelection]="true">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="Fecha" style="width:80%">Nombre de la meta <p-sortIcon field="Fecha"></p-sortIcon></th>
              <th pSortableColumn="Fecha" style="width:20%" class="text-center">Acciones <p-sortIcon field="Fecha"></p-sortIcon></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-meta>
            <tr [pSelectableRow]="meta">
              <td>
                <div>
                  <h6>
                    {{meta.nombre}}
                  </h6>
                </div>
                <div style="font-size: 12px;">
                  Fecha creada: {{meta.fechaCreacion | date:'dd-MM-yyyy'}}
                </div>
                <div class="pt-2">
                  Tareas completadas: {{meta.concluidos}} / {{meta.total}}
                </div>
                <p-progressBar class="mt-2" [value]="meta.barra">
                  <ng-template pTemplate="content" let-value> 
                  <span>{{meta.concluidos}} / {{meta.total}}</span>    
                  </ng-template>
                </p-progressBar>
              </td>
              <td class="text-center">
                <i class="pi pi-pencil text-primary pr-2" role="button" (click)="AgregarEditarMeta('editar', meta.idMeta)"></i>
                <i class="pi pi-trash text-danger" role="button" (click)="DeleteMeta(meta.idMeta)"></i>
              </td>
            </tr>
          </ng-template>
        </p-table> 
      </div>
    </div>   
  </div>
  <div class="col-md-6">
    <div class="row jumbotron m-1 p-4 bg-white shadow" *ngIf="metaSeleccionada">
      <div class="col-md-12">
        <p-button (click)="AgregarEditarTarea('agregar', 0, metaSeleccionada)" icon="pi pi-plus" label="Agregar tarea" styleClass="rounded mb-2 mr-1" size="small"></p-button>
        <p-button icon="pi pi-check" label="Completar tarea" styleClass="rounded mb-2 mr-1" size="small" *ngIf="tareaSeleccionada" (click)="CompletarTarea(tareaSeleccionada.idTarea)"></p-button>
        <p-button icon="pi pi-pencil" label="Editar tarea" styleClass="rounded mb-2 mr-1" size="small" *ngIf="tareaSeleccionada" (click)="AgregarEditarTarea('editar', tareaSeleccionada.idTarea, metaSeleccionada.idMeta)"></p-button>
        <p-button icon="pi pi-trash" label="Eliminar tarea" styleClass="rounded mb-2" size="small" *ngIf="tareaSeleccionada" (click)="DeleteTarea(tareaSeleccionada.idTarea)"></p-button>

        <p-table [value]="tareasLista" selectionMode="single" [(selection)]="tareaSeleccionada">
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="Nombre" style="width:60%">Nombre de la meta <p-sortIcon field="Nombre"></p-sortIcon></th>
              <th pSortableColumn="Fecha" style="width:20%" class="text-center">Fecha <p-sortIcon field="Fecha"></p-sortIcon></th>
              <th pSortableColumn="Estado" style="width:20%" class="text-center">Estado <p-sortIcon field="Estado"></p-sortIcon></th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-tarea>
            <tr [pSelectableRow]="tarea">
              <td>
                <div>
                  <p-radioButton name="tarea" [value]="tarea" [(ngModel)]="tareaSeleccionada" [inputId]="tarea.Id" (onClick)="SeleccionOpt($event)"></p-radioButton>
                  {{tarea.nombre}}
                </div>
              </td>
              <td class="text-center">
                  {{tarea.fechaCreacion | date:'dd-MM-yyyy'}}
              </td>
              <td class="text-center">
                <span [ngClass]="tarea.estatus == 'ConcluÃ­da' ? 'text-success text-bold' : ''">
                  {{tarea.estatus}}
                </span>
              </td>
            </tr>
          </ng-template>
        </p-table> 
      </div>
    </div>
  </div>  
</div>

<!-- Dialog para registrar meta -->
<p-dialog [(visible)]="metaDialog" [modal]="true" [style]="{ width: '30rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
  <ng-template pTemplate="headless">
    <div class="bg-white rounded">
      <div class="inline-flex align-items-center justify-content-center bg-info p-4">
        <div class="lead">
          <span class="font-bold white-space-nowrap">{{tituloDialogMeta}}</span>
        </div>
      </div>
          
      <div class="p-4">
        <form [formGroup]="formMeta" class="pt-4">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <span class="p-float-label p-fluid">
                  <input type="text" pInputText formControlName="txtMeta" placeholder="Nombre de la meta" [autofocus]="true" (keydown.enter)="PostMeta()" />
                  <label class="font-weight-normal">Nombre de la meta</label>
                </span>
              </div>
            </div>
          </div>
        </form>

        <div class="text-right pt-2">
          <p-button label="Aceptar" styleClass="rounded p-button-success" [disabled]="formMeta.invalid" (onClick)="PostMeta()"></p-button>&nbsp;
          <p-button (click)="metaDialog = false" label="Cancelar" styleClass="rounded p-button-danger"></p-button>
        </div>   
      </div>   
    </div>
  </ng-template>
</p-dialog>

<!-- Dialog para registrar tarea -->
<p-dialog [(visible)]="tareaDialog" [modal]="true" [style]="{ width: '30rem' }" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }">
  <ng-template pTemplate="headless">
    <div class="bg-white rounded">
      <div class="inline-flex align-items-center justify-content-center bg-info p-4">
        <div class="lead">
          <span class="font-bold white-space-nowrap">{{tituloDialogTarea}}</span>
        </div>
      </div>
          
      <div class="p-4">
        <form [formGroup]="formTarea" class="pt-4">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <span class="p-float-label p-fluid">
                  <input type="text" pInputText formControlName="txtTarea" placeholder="Nombre de la tarea" [autofocus]="true" />
                  <label class="font-weight-normal">Nombre de la tarea</label>
                </span>
              </div>
            </div>
          </div>
        </form>

        <div class="text-right pt-2">
          <p-button label="Aceptar" styleClass="rounded p-button-success" [disabled]="formTarea.invalid" (onClick)="PostTarea()"></p-button>&nbsp;
          <p-button (click)="tareaDialog = false" label="Cancelar" styleClass="rounded p-button-danger"></p-button>
        </div>   
      </div>   
    </div>
  </ng-template>
</p-dialog>